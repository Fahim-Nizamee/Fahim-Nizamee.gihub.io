<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Converter</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    
    <script>
    $(function(){
      $("#nav").load("navbar.html");
    });
    $(function(){
      $("#footer").load("footer.html");
    });
    $(function(){
      $("#footerad").load("footerad.html");
    });
    $(function(){
      $("#headerad").load("headerad.html");
    });
    </script>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" type='text/javascript'></script>


</head>
<body>
    <div id="nav"></div>
    <div class="container my-5">
        <div class="row">
        <div class="col-sm-12">
        <h1 class="text-center" style="font-variant-caps:petite-caps;">Currency Converter</h1>
    <div id="headerad"></div>

    <div class="form-control bg-dark shadow">
        <div class="currency-converter">
          <div class="exchange-rate text-center text-white" style="font-variant-caps:petite-caps ;">
            <p class="text-white">--- equals</p>
            <h1>---</h1>
          </div>
          <div class="from-currency form-control bg-primary">
            <input type="number" class="form-control" id="from-currency-amount" value="1" />
            <select class="form-control text-center">
              <option>USD - United States Dollar</option>
            </select>
          </div>
          <br>
          <div class="to-currency form-control bg-success">
            <input type="number" class="form-control" id="to-currency-amount" />
            <select class="form-control text-center" >
              <option>BDT - Bangladeshi Taka</option>
            </select>
          </div>
        </div>
      </div>
  
      <!-- <script src="js/converter.js"></script>   -->
      <script>
        // SELECT ELEMENTS
const exchangeRateEl = document.querySelector('.exchange-rate');

const f_select = document.querySelector('.from-currency select');
const t_select = document.querySelector('.to-currency select');
const f_input = document.querySelector('#from-currency-amount');
const t_input = document.querySelector('#to-currency-amount');

// HELPERS : get inputs values
function fromCurrencyCode() {
  return f_select.value;
}
function toCurrencyCode() {
  return t_select.value;
}
function fromCurrencyAmount() {
  return f_input.value;
}
function toCurrencyAmount() {
  return t_input.value;
}

// VARS AND CONSTS
const DEFAULT_BASE_CURRENCY_CODE = 'USD';
const DATA_PRECISION = 2;
let exchangeRate;
let currenciesList;
let ECO_MODE = true;

// API PROVIDERS
const ipdata = {
  baseurl: 'https://api.ipdata.co',
  key: '13952c49cd907f6b9a168b62b0b2364ba3eb022e303cd6aec6afb8cd',

  currency: function () {
    return `${this.baseurl}/currency?api-key=${ipdata.key}`;
  },
};
const currencyLayer = {
  baseurl: 'http://api.currencylayer.com',
  key: '816aace5f867a203d108dde0987d9681',

  list: function () {
    return `${this.baseurl}/list?access_key=${this.key}`;
  },
  convert: function (from, to, amount) {
    return `${this.baseurl}/convert?from=${from}&to=${to}&amount=${amount}&access_key=${this.key}`;
  },
};

// GET ALL CURRENCIES CODES AND NAMES
async function getCurrenciesList() {
  const response = await fetch(currencyLayer.list());   
  const data = await response.json();
  const currencies = data.currencies;

  return currencies;
}

// GET USER'S LOCAL CURRENCY
async function getUserCurrency() {
  const response = await fetch(ipdata.currency());
  const currency = await response.json();

  return {
    name: currency.name,
    code: currency.code,
  };
}

// INITIALIZE APP
async function init() {
  userCurrency = await getUserCurrency();
  currenciesList = await getCurrenciesList();

  renderSelectOptions(currenciesList, DEFAULT_BASE_CURRENCY_CODE, userCurrency.code);

  await renderExchangeRate(DEFAULT_BASE_CURRENCY_CODE, userCurrency.code);

  convert('from->to');
}
init();

// get exchange rate
async function getExchangeRate(fromCurrencyCode, toCurrencyCode) {
  const amount = 1;

  const response = await fetch(currencyLayer.convert(fromCurrencyCode, toCurrencyCode, amount));
  const data = await response.json();
  const rate = data.result;

  return rate;
}

// render exchange rate
async function renderExchangeRate(fromCurrencyCode, toCurrencyCode) {
  exchangeRate = await getExchangeRate(fromCurrencyCode, toCurrencyCode);

  plural = exchangeRate === 1 ? 's' : '';

  exchangeRateEl.innerHTML = `<h5 class="text-white">1 ${currenciesList[fromCurrencyCode]} equals</h5>
  <h1>${exchangeRate.toFixed(DATA_PRECISION)} ${currenciesList[toCurrencyCode]}${plural}</h1>`;
}

// render select options
function renderSelectOptions(list, defaultBaseCurrencyCode, userCurrencyCode) {
  f_select.innerHTML = '';
  t_select.innerHTML = '';

  for (const currencyCode in list) {
    const currencyName = list[currencyCode];

    selectedFromCurrency = defaultBaseCurrencyCode === currencyCode ? 'selected' : '';
    selectedToCurrency = userCurrencyCode === currencyCode ? 'selected' : '';

    f_select.innerHTML += `<option value="${currencyCode}" ${selectedFromCurrency}>
                                          ${currencyCode} - ${currencyName}</option>`;
    t_select.innerHTML += `<option value="${currencyCode}" ${selectedToCurrency}>
                                          ${currencyCode} - ${currencyName}</option>`;
  }
}

// convert
async function convert(direction) {
  if (direction === 'from->to') {
    t_input.value = (fromCurrencyAmount() * exchangeRate).toFixed(DATA_PRECISION);
  } else if (direction === 'to->from') {
    f_input.value = (toCurrencyAmount() / exchangeRate).toFixed(DATA_PRECISION);
  }
}

// EVENT LISTENERS
f_select.addEventListener('change', async () => {
  await renderExchangeRate(fromCurrencyCode(), toCurrencyCode());
  convert('from->to');
});
t_select.addEventListener('change', async () => {
  await renderExchangeRate(fromCurrencyCode(), toCurrencyCode());
  convert('to->from');
});
f_input.addEventListener('input', async () => {
  if (!ECO_MODE) {
    exchangeRate = await getExchangeRate(fromCurrencyCode(), toCurrencyCode());
  }
  convert('from->to');
});
t_input.addEventListener('input', async () => {
  if (!ECO_MODE) {
    exchangeRate = await getExchangeRate(fromCurrencyCode(), toCurrencyCode());
  }
  convert('to->from');
});

      </script>     

    <div id="footerad"></div>
    </div>
</div>
</div>
<div id="footer"></div>
</body>
</html>